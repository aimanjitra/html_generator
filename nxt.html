<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>CV → HTML Generator (ChatGPT / DeepSeek)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{--primary:#6c5ce7;--accent:#fd79a8;--dark:#2d3436}
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:Segoe UI,Arial,sans-serif;padding:20px;background:#f5f7fa;color:var(--dark)}
    .container{max-width:1100px;margin:0 auto}
    .card{background:#fff;border-radius:12px;padding:20px;margin-bottom:18px;box-shadow:0 8px 24px rgba(0,0,0,.06)}
    .button{background:var(--primary);color:#fff;padding:12px 18px;border-radius:10px;border:0;cursor:pointer}
    textarea{width:100%;height:420px;border-radius:8px;border:1px solid #e6e6e6;padding:12px;font-family:monospace}
    .progress-bar{height:8px;background:#eee;border-radius:6px;overflow:hidden;margin-top:12px}
    .progress-fill{height:100%;width:0%;background:linear-gradient(90deg,var(--primary),var(--accent));transition:width .4s}
    label{display:block;margin-top:8px}
    input[type="text"], input[type="file"]{width:100%;padding:8px;border-radius:6px;border:1px solid #ddd;margin-top:6px}
    .small{font-size:0.9rem;color:#666}
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h2>Upload CV (optional)</h2>
      <p class="small">Upload PDF/DOCX. If you already uploaded earlier on server, it will use the default local path.</p>

      <div>
        <input id="cv" type="file" />
        <div class="progress-bar"><div id="uploadProgress" class="progress-fill"></div></div>
        <button id="uploadBtn" class="button" style="margin-top:10px">Upload CV</button>
        <div id="uploadResult"></div>
      </div>
    </div>

    <div class="card">
      <h2>Generate Full Website HTML</h2>
      <p class="small">Provide DeepSeek share link (optional) and your theme preferences.</p>

      <label>
        DeepSeek link (optional)
        <input id="deepseekUrl" type="text" placeholder="https://chat.deepseek.com/a/chat/s/..." />
      </label>

      <label>
        Theme type
        <input id="themeType" type="text" placeholder="e.g. modern / cyber / photo" />
      </label>

      <label>
        Colors
        <input id="themeColors" type="text" placeholder="e.g. black yellow / #000 #ff0" />
      </label>

      <label style="margin-top:8px">
        <input id="professional" type="checkbox" checked /> Professional layout
      </label>

      <button id="generate" class="button" style="margin-top:12px">✨ Generate Full HTML</button>
      <div id="resultStatus"></div>
    </div>

    <div class="card">
      <h2>Generated HTML (full page)</h2>
      <textarea id="out" placeholder="Generated full HTML will appear here..."></textarea>
    </div>
  </div>

<script>
  // CHANGE THIS to your backend URL (Render service URL) if different:
  const BACKEND_BASE = 'https://html-generator-oos8.onrender.com';

  const cvInput = document.getElementById('cv');
  const uploadBtn = document.getElementById('uploadBtn');
  const uploadProgress = document.getElementById('uploadProgress');
  const uploadResult = document.getElementById('uploadResult');

  const deepseekUrlInput = document.getElementById('deepseekUrl');
  const themeTypeInput = document.getElementById('themeType');
  const themeColorsInput = document.getElementById('themeColors');
  const professionalCheckbox = document.getElementById('professional');
  const generateBtn = document.getElementById('generate');
  const outTextarea = document.getElementById('out');
  const resultStatus = document.getElementById('resultStatus');

  // <-- default server-side file path (set to the uploaded CV path you provided) -->
  let uploadedFileUrl = '/mnt/data/CV Aiman.pdf';

  uploadBtn.addEventListener('click', async () => {
    if (!cvInput.files.length) {
      uploadResult.innerHTML = '<div class="small" style="color:#b02a22">Please choose a CV first</div>';
      return;
    }
    const fd = new FormData();
    fd.append('cv', cvInput.files[0]);

    uploadProgress.style.width = '0%';
    let progress = 0;
    const timer = setInterval(() => { progress = Math.min(90, progress + 8); uploadProgress.style.width = progress + '%'; }, 150);

    try {
      const res = await fetch(BACKEND_BASE + '/upload-cv', { method: 'POST', body: fd });
      const j = await res.json();
      clearInterval(timer);
      uploadProgress.style.width = '100%';
      if (j && (j.ok || j.success)) {
        if (j.localPath) uploadedFileUrl = j.localPath;
        if (j.url) uploadedFileUrl = j.url;
        uploadResult.innerHTML = '<div class="small" style="color:#008a4b">Upload successful</div>';
      } else {
        uploadResult.innerHTML = '<div class="small" style="color:#b02a22">Upload failed</div>';
      }
    } catch (err) {
      clearInterval(timer);
      uploadProgress.style.width = '0%';
      uploadResult.innerHTML = '<div class="small" style="color:#b02a22">Upload error: ' + err.message + '</div>';
    }
  });

  generateBtn.addEventListener('click', async () => {
    const deepseekUrl = (deepseekUrlInput.value || '').trim();
    const themeType = (themeTypeInput.value || 'modern').trim();
    const themeColors = (themeColorsInput.value || '').trim();
    const professional = professionalCheckbox.checked;

    setGenerating(true, 'Requesting long-form HTML — this may take a minute.');

    try {
      const payload = { deepseekUrl, themeType, themeColors, professional, uploadedFilePath: uploadedFileUrl };
      const res = await fetch(BACKEND_BASE + '/generate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      const j = await res.json();
      if (!j || !j.ok) throw new Error((j && j.error) ? j.error : 'No response from server');
      outTextarea.value = j.html || '';
      resultStatus.innerHTML = '<div class="small" style="color:#008a4b">Full HTML received — copy from the box above.</div>';
    } catch (err) {
      resultStatus.innerHTML = '<div class="small" style="color:#b02a22">Error: ' + err.message + '</div>';
    } finally {
      setGenerating(false);
    }
  });

  function setGenerating(on, msg='') {
    if (on) {
      generateBtn.disabled = true;
      generateBtn.textContent = '⏳ Generating…';
      resultStatus.innerHTML = msg ? '<div class="small">' + msg + '</div>' : '';
    } else {
      generateBtn.disabled = false;
      generateBtn.textContent = '✨ Generate Full HTML';
    }
  }

  // init
  uploadProgress.style.width = '0%';
</script>
</body>
</html>
