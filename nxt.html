<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>üé® CV + DeepSeek ‚Üí HTML Generator</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    /* (styles unchanged from your version ‚Äî kept for brevity) */
    :root{--primary:#6c5ce7;--secondary:#a29bfe;--accent:#fd79a8;--dark:#2d3436;--light:#f7f7f7;--success:#00b894;--warning:#fdcb6e;--danger:#e17055}
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'Segoe UI',Tahoma,Helvetica,Arial,sans-serif;margin:0;padding:20px;background:linear-gradient(135deg,#f5f7fa 0%,#c3cfe2 100%);color:var(--dark);min-height:100vh}
    .container{max-width:1200px;margin:0 auto}
    header{ text-align:center;margin-bottom:30px;padding:20px;background:rgba(255,255,255,.9);border-radius:20px;box-shadow:0 10px 30px rgba(0,0,0,.1);position:relative;overflow:hidden }
    header::before{content:"";position:absolute;top:0;left:0;width:100%;height:5px;background:linear-gradient(90deg,var(--primary),var(--accent),var(--success))}
    h1{font-size:2.5rem;color:var(--primary);margin-bottom:10px;display:flex;align-items:center;justify-content:center;gap:15px}
    .subtitle{font-size:1.1rem;color:var(--dark);opacity:.8}
    .dashboard{display:grid;grid-template-columns:1fr 1fr;gap:30px;margin-bottom:30px}
    @media(max-width:768px){.dashboard{grid-template-columns:1fr}}
    .card{background:rgba(255,255,255,.95);border-radius:20px;padding:25px;box-shadow:0 10px 30px rgba(0,0,0,.08);transition:transform .3s ease,box-shadow .3s ease}
    .card-title{font-size:1.5rem;margin-bottom:20px;color:var(--primary);display:flex;align-items:center;gap:10px}
    label{display:block;margin-bottom:8px;font-weight:600;color:var(--dark)}
    .file-upload-area{border:2px dashed var(--secondary);border-radius:12px;padding:30px;text-align:center;cursor:pointer;background:rgba(162,155,254,.05)}
    .progress-bar{height:8px;background:#e0e0e0;border-radius:4px;overflow:hidden;margin:20px 0}
    .progress-fill{height:100%;background:linear-gradient(90deg,var(--primary),var(--accent));width:0%;transition:width .5s}
    .button{background:var(--primary);color:#fff;border:none;padding:15px 30px;border-radius:12px;font-size:1.05rem;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;width:100%}
    .button-secondary{background:var(--secondary)}
    .button-success{background:var(--success)}
    textarea{width:100%;height:420px;border:2px solid #e0e0e0;border-radius:12px;padding:15px;font-family:'Courier New',monospace;font-size:.9rem;resize:vertical;white-space:pre;overflow:auto}
    .status-message{padding:12px;border-radius:12px;margin:12px 0;font-weight:600}
    .status-success{background:rgba(0,184,148,.12);color:var(--success);border:1px solid var(--success)}
    .status-error{background:rgba(225,112,85,.12);color:var(--danger);border:1px solid var(--danger)}
    .loading { opacity: .9; pointer-events: none; filter: blur(0.2px); }
    .notification{position:fixed;top:20px;right:20px;padding:12px 18px;border-radius:10px;color:#fff;z-index:1000;transform:translateX(150%);transition:transform .35s}
    .notification.show{transform:translateX(0)}
    .notification-success{background:var(--success)}
    .notification-error{background:var(--danger)}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üé® CV + DeepSeek ‚Üí HTML Generator</h1>
      <p class="subtitle">Request a full website HTML (long version) from DeepSeek and copy-paste the result.</p>
    </header>

    <div class="dashboard">
      <div class="card">
        <h2 class="card-title">üìÑ Step 1: Upload Your CV</h2>

        <div class="input-group">
          <label for="cv">Upload your CV (PDF/DOCX)</label>
          <div class="file-upload-area" id="fileUploadArea">
            <div class="file-upload-text">Drag & drop your CV here</div>
            <div class="file-upload-hint">or click to browse files</div>
            <input id="cv" type="file" style="display:none" />
          </div>

          <div class="progress-bar"><div class="progress-fill" id="uploadProgress"></div></div>

          <button id="uploadBtn" class="button button-secondary">üöÄ Upload CV</button>
          <div id="uploadResult"></div>
        </div>

        <h2 class="card-title">üîó Step 2: DeepSeek Link</h2>
        <div class="input-group">
          <label for="deepseekUrl">DeepSeek Link (or API URL)</label>
          <input id="deepseekUrl" type="text" placeholder="https://chat.deepseek.com/share/..." style="width:100%;padding:12px;border-radius:10px;border:1px solid #ddd" />
        </div>
      </div>

      <div class="card">
        <h2 class="card-title">üé≠ Step 3: Customize</h2>

        <div class="input-group">
          <label for="themeType">Theme Type</label>
          <input id="themeType" type="text" placeholder="e.g. modern / cyber / photo" style="width:100%;padding:12px;border-radius:10px;border:1px solid #ddd" />
        </div>

        <div class="input-group">
          <label for="themeColors">Theme Colors</label>
          <input id="themeColors" type="text" placeholder="e.g. red white / #ff0000 #fff" style="width:100%;padding:12px;border-radius:10px;border:1px solid #ddd" />
        </div>

        <div class="input-group" style="margin-bottom:18px">
          <label><input id="professional" type="checkbox" checked /> Professional layout</label>
        </div>

        <button id="generate" class="button button-success">‚ú® Generate Full HTML from DeepSeek</button>
      </div>
    </div>

    <div class="output-area">
      <div class="card">
        <h2 class="card-title">üìã Generated HTML (full website)</h2>
        <p>Copy the full HTML produced by DeepSeek ‚Äî long version with animations and full structure.</p>
        <textarea id="out" placeholder="Generated full HTML will appear here..."></textarea>

        <div id="resultStatus"></div>
      </div>
    </div>
  </div>

  <div id="notification" class="notification"></div>

  <script>
    /* ==== CONFIG: set your backend base URL here ==== */
    const BACKEND_BASE = 'https://html-generator-oos8.onrender.com'; // <-- CHANGE if different

    // The local file path you asked to include (tooling will transform this path to a URL on the backend side)
    // Per your instruction I include this path so backend/tooling can use it:
    const DEFAULT_UPLOADED_FILE_PATH = '/mnt/data/f124d69d-5701-4fec-9c21-e5db7eecd1cc.png';

    // DOM refs
    const fileUploadArea = document.getElementById('fileUploadArea');
    const cvInput = document.getElementById('cv');
    const uploadBtn = document.getElementById('uploadBtn');
    const uploadResult = document.getElementById('uploadResult');
    const uploadProgress = document.getElementById('uploadProgress');
    const deepseekUrlInput = document.getElementById('deepseekUrl');
    const themeTypeInput = document.getElementById('themeType');
    const themeColorsInput = document.getElementById('themeColors');
    const professionalCheckbox = document.getElementById('professional');
    const generateBtn = document.getElementById('generate');
    const outputTextarea = document.getElementById('out');
    const resultStatus = document.getElementById('resultStatus');
    const notification = document.getElementById('notification');

    // state: URL (or path) of uploaded CV. We default to the provided local path
    let uploadedFileUrl = DEFAULT_UPLOADED_FILE_PATH;

    // click to open file browser
    fileUploadArea.addEventListener('click', () => cvInput.click());
    cvInput.addEventListener('change', (e) => {
      if (e.target.files.length) {
        const name = e.target.files[0].name;
        fileUploadArea.innerHTML = `<div class="file-upload-text">üìÑ ${name}</div><div class="file-upload-hint">Click to change file</div>`;
      }
    });

    // drag & drop support
    fileUploadArea.addEventListener('dragover', (e) => { e.preventDefault(); fileUploadArea.style.borderColor='var(--primary)'; });
    fileUploadArea.addEventListener('dragleave', () => { fileUploadArea.style.borderColor='var(--secondary)'; });
    fileUploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      if (e.dataTransfer.files.length) {
        cvInput.files = e.dataTransfer.files;
        fileUploadArea.innerHTML = `<div class="file-upload-text">üìÑ ${e.dataTransfer.files[0].name}</div><div class="file-upload-hint">Click to change file</div>`;
      }
    });

    // Upload handler: sends the CV to backend; on success backend should return a public URL (optional).
    // If backend returns a URL use it; otherwise we keep the DEFAULT_UPLOADED_FILE_PATH so tools can transform it.
    uploadBtn.addEventListener('click', async () => {
      if (!cvInput.files.length) {
        showNotification('Please choose a CV file first', 'error');
        return;
      }

      // show progress animation
      let progress = 0;
      const t = setInterval(() => { progress = Math.min(100, progress + 6); uploadProgress.style.width = progress + '%'; if (progress===100) clearInterval(t); }, 150);

      try {
        const fd = new FormData();
        fd.append('cv', cvInput.files[0]);

        const res = await fetch(BACKEND_BASE + '/upload-cv', { method: 'POST', body: fd });
        const j = await res.json();

        clearInterval(t);
        uploadProgress.style.width = '100%';

        // backend returned { ok: true, filename, originalname } in earlier sample - adapt to your backend response
        if (j && (j.ok || j.success)) {
          // if backend returns a public URL, use it; otherwise leave uploadedFileUrl as default and show success
          if (j.url) uploadedFileUrl = j.url;
          else if (j.publicUrl) uploadedFileUrl = j.publicUrl;
          uploadResult.innerHTML = `<div class="status-message status-success">‚úÖ CV uploaded successfully!</div>`;
          showNotification('CV uploaded successfully!', 'success');
        } else {
          uploadResult.innerHTML = `<div class="status-message status-error">‚ùå Upload failed: ${j && j.error ? j.error : 'Unknown'}</div>`;
          showNotification('Upload failed', 'error');
        }
      } catch (err) {
        uploadResult.innerHTML = `<div class="status-message status-error">‚ùå Upload error: ${err.message}</div>`;
        uploadProgress.style.width = '0%';
        showNotification('Upload error', 'error');
      }
    });

    // Generate long/full HTML from DeepSeek
    generateBtn.addEventListener('click', async () => {
      const deepseekUrl = deepseekUrlInput.value.trim();
      const themeType = themeTypeInput.value.trim() || 'modern';
      const themeColors = themeColorsInput.value.trim() || '';
      const professional = professionalCheckbox.checked;

      if (!deepseekUrl) {
        showNotification('Please enter a DeepSeek link', 'error');
        return;
      }

      // disable UI while generating
      setLoading(true, 'Requesting full HTML from DeepSeek ‚Äî this can take a while...');

      try {
        // We send an explicit instruction so DeepSeek (or your backend proxy) knows to output a full website HTML (long).
        // The backend should use DeepSeek API or fetch the share link and instruct the model:
        //
        // PROMPT (sent as "promptInstruction"): "Create a full static website HTML (complete <html>... including head, styles, animations, and any assets inline where possible) from the CV located at [uploadedFileUrl]. Use theme: <themeType>, colors: <themeColors>, professional: <true/false>. Return only the full HTML document (no commentary)."
        //
        // The backend should forward this prompt to DeepSeek (or append to the content) and return j.html with the full code.
        //
        const payload = {
          deepseekUrl,
          themeType,
          themeColors,
          professional,
          // explicit instruction to request the *full* generated website HTML
          promptInstruction: `Create a full static website HTML based on the provided CV. Include full <html> structure, head, styles, and animations. Use theme "${themeType}", colors "${themeColors}", and professional=${professional}. The result must be the COMPLETE HTML source (no summaries). If possible inline critical CSS and minimal external resources. Reference the applicant CV at uploadedFileUrl and use it to populate content.`,
          // include uploaded path (tooling/back-end will transform to a usable URL)
          uploadedFileUrl: uploadedFileUrl
        };

        const res = await fetch(BACKEND_BASE + '/generate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        const j = await res.json();

        if (!j || !j.ok) {
          // backend may return error details
          throw new Error(j && j.error ? j.error : 'Generate failed');
        }

        // j.html is expected to be the full website HTML (long form)
        outputTextarea.value = j.html || '';
        resultStatus.innerHTML = `<div class="status-message status-success">Full HTML received ‚Äî copy from the box above.</div>`;
        showNotification('Full HTML generated', 'success');
      } catch (err) {
        resultStatus.innerHTML = `<div class="status-message status-error">Error generating HTML: ${err.message}</div>`;
        showNotification('Error: ' + err.message, 'error');
      } finally {
        setLoading(false);
      }
    });

    // small helpers
    function showNotification(msg, type='success') {
      notification.textContent = msg;
      notification.className = `notification notification-${type} show`;
      setTimeout(() => notification.classList.remove('show'), 3500);
    }

    function setLoading(isLoading, statusText='') {
      if (isLoading) {
        generateBtn.disabled = true;
        generateBtn.textContent = '‚è≥ Generating ‚Äî please wait...';
        document.body.classList.add('loading');
        resultStatus.innerHTML = statusText ? `<div class="status-message status-info">${statusText}</div>` : '';
      } else {
        generateBtn.disabled = false;
        generateBtn.innerHTML = '‚ú® Generate Full HTML from DeepSeek';
        document.body.classList.remove('loading');
      }
    }

    // initialize small UI state
    uploadProgress.style.width = '0%';
  </script>
</body>
</html>
